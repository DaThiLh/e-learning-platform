generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Adjustment {
  course_id Int      @db.UnsignedMediumInt
  admin_id  Int      @db.UnsignedMediumInt
  create_at DateTime @default(now()) @db.DateTime(0)
  content   String   @db.VarChar(10000)
  Admin     Admin    @relation(fields: [admin_id], references: [admin_id], onDelete: NoAction, onUpdate: NoAction, map: "FK_Adjustment_Admin")
  Course    Course   @relation(fields: [course_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_Adjustment_Course")

  @@id([course_id, admin_id, create_at])
  @@index([admin_id], map: "FK_Adjustment_Admin")
}

model Admin {
  admin_id   Int          @id @db.UnsignedMediumInt
  Adjustment Adjustment[]
  User       User         @relation(fields: [admin_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_Admin_User")
}

model Answer {
  question_id     Int      @db.UnsignedSmallInt
  answer_id       Int      @db.UnsignedSmallInt
  item_id         Int      @db.UnsignedSmallInt
  course_id       Int      @db.UnsignedMediumInt
  section_id      Int      @db.UnsignedSmallInt
  answer_datetime DateTime @db.DateTime(0)
  answer_message  String   @db.VarChar(600)
  user_id         Int      @db.UnsignedMediumInt
  User            User     @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_Answer_User")
  Question        Question @relation(fields: [question_id, item_id, section_id, course_id], references: [question_id, item_id, section_id, course_id], onDelete: NoAction, onUpdate: NoAction, map: "FK_Question")

  @@id([question_id, answer_id, item_id, course_id, section_id])
  @@index([user_id], map: "FK_Answer_User")
  @@index([question_id, item_id, section_id, course_id], map: "FK_Question")
}

model Category {
  category_id   Int          @id @db.UnsignedTinyInt
  category_name String       @db.VarChar(50)
  SubCategory   SubCategory?
}

model Course {
  id                  Int                   @id @default(autoincrement()) @db.UnsignedMediumInt
  title               String                @db.VarChar(60)
  subtitle            String                @db.VarChar(120)
  description         String                @db.VarChar(2000)
  language            String                @db.VarChar(27)
  requirement         String                @db.VarChar(160)
  image               String                @db.VarChar(2084)
  tier_id             Int                   @db.UnsignedTinyInt
  status              Course_status         @default(pending)
  subcategory_id      Int                   @db.UnsignedTinyInt
  Adjustment          Adjustment[]
  SubCategory         SubCategory           @relation(fields: [subcategory_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_Course_SubCategory")
  Tier                Tier                  @relation(fields: [tier_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_Course_Tier")
  CourseHighlight     CourseHighlight?
  CourseInstructor    CourseInstructor[]
  CourseObjective     CourseObjective[]
  EnrollementCourse   EnrollementCourse[]
  MonthlyCourseIncome MonthlyCourseIncome[]
  Notification        Notification[]
  Section             Section[]
  ShoppingCart        ShoppingCart[]

  @@index([subcategory_id], map: "FK_Course_SubCategory")
  @@index([tier_id], map: "FK_Course_Tier")
}

model CourseHighlight {
  id                     Int    @id @db.UnsignedMediumInt
  downloadable_documents Int    @default(0) @db.UnsignedSmallInt
  students_enrolled      Int    @default(0) @db.UnsignedMediumInt
  average_rating         Float  @default(0) @db.Float
  sale_price             Int    @default(0) @db.UnsignedMediumInt
  no_sections            Int    @default(0) @db.UnsignedSmallInt
  duration               Int    @default(0) @db.UnsignedMediumInt
  Course                 Course @relation(fields: [id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_CourseHighlight_Course")
}

model CourseInstructor {
  course_id               Int                       @db.UnsignedMediumInt
  instructor_id           Int                       @db.UnsignedMediumInt
  profit_percent          Int                       @db.UnsignedSmallInt
  Course                  Course                    @relation(fields: [course_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_CourseInstructor_Course")
  Instructor              Instructor                @relation(fields: [instructor_id], references: [instructor_id], onDelete: NoAction, onUpdate: NoAction, map: "FK_CourseInstructor_Instructor")
  CourseInstructorHistory CourseInstructorHistory[]

  @@id([course_id, instructor_id])
  @@index([instructor_id], map: "FK_CourseInstructor_Instructor")
}

model CourseInstructorHistory {
  course_id             Int              @db.UnsignedMediumInt
  instructor_id         Int              @db.UnsignedMediumInt
  create_at             DateTime         @default(now()) @db.DateTime(0)
  course_profit_percent Int              @db.UnsignedSmallInt
  CourseInstructor      CourseInstructor @relation(fields: [course_id, instructor_id], references: [course_id, instructor_id], onDelete: NoAction, onUpdate: NoAction, map: "FK_CourseInstructor_CourseID")

  @@id([course_id, instructor_id, create_at])
}

model CourseObjective {
  course_id        Int    @db.UnsignedMediumInt
  course_objective String @db.VarChar(160)
  Course           Course @relation(fields: [course_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_CourseObjective_Course")

  @@id([course_id, course_objective])
}

model CourseProgress {
  course_id         Int               @db.UnsignedMediumInt
  section_id        Int               @db.UnsignedSmallInt
  item_id           Int               @db.UnsignedSmallInt
  learner_id        Int               @db.UnsignedMediumInt
  EnrollementCourse EnrollementCourse @relation(fields: [course_id, learner_id], references: [course_id, learner_id], onDelete: NoAction, onUpdate: NoAction, map: "FK_CourseProgress_EnrollementCourse")
  Item              Item              @relation(fields: [course_id, section_id, item_id], references: [course_id, section_id, id], onDelete: NoAction, onUpdate: NoAction, map: "FK_CourseProgress_Item")

  @@id([course_id, section_id, item_id, learner_id])
  @@index([course_id, learner_id], map: "FK_CourseProgress_EnrollementCourse")
}

model EnrollementCourse {
  course_id              Int               @db.UnsignedMediumInt
  learner_id             Int               @db.UnsignedMediumInt
  course_completion_date DateTime?         @db.Date
  course_rating          Int?              @db.UnsignedSmallInt
  course_comment         String?           @db.VarChar(2000)
  final_course_price     Int               @db.UnsignedMediumInt
  payment_id             Int               @db.UnsignedMediumInt
  CourseProgress         CourseProgress[]
  Learner                Learner           @relation(fields: [learner_id], references: [learner_id], onDelete: NoAction, onUpdate: NoAction, map: "FK_EnrollementCours_Learner")
  Course                 Course            @relation(fields: [course_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_EnrollementCourse_Course")
  Payment                Payment           @relation(fields: [payment_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_Payment")
  StudentAnswerQA        StudentAnswerQA[]

  @@id([course_id, learner_id])
  @@index([learner_id], map: "FK_EnrollementCours_Learner")
  @@index([payment_id], map: "FK_Payment")
}

model Instructor {
  instructor_id    Int                        @id @db.UnsignedMediumInt
  date_of_birth    DateTime                   @db.Date
  address          String                     @db.VarChar(255)
  phone            String                     @db.VarChar(11)
  academic_degree  String                     @db.VarChar(50)
  working_unit     String                     @db.VarChar(100)
  academic_title   String                     @db.VarChar(50)
  description      String                     @db.VarChar(1000)
  instructor_type  Instructor_instructor_type
  CourseInstructor CourseInstructor[]
  User             User                       @relation(fields: [instructor_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_Instructor_User")
  VipInstructor    VipInstructor?
}

model Item {
  id             Int              @db.UnsignedSmallInt
  section_id     Int              @db.UnsignedSmallInt
  course_id      Int              @db.UnsignedMediumInt
  title          String           @db.VarChar(80)
  description    String           @db.VarChar(255)
  item_type      Item_item_type
  CourseProgress CourseProgress[]
  Section        Section          @relation(fields: [course_id, section_id], references: [course_id, id], onDelete: NoAction, onUpdate: NoAction, map: "FK_Item_Section")
  ItemHistory    ItemHistory[]
  ItemOrder      ItemOrder?
  Lecture        Lecture?
  Question       Question[]
  Quiz           Quiz?

  @@id([id, section_id, course_id])
  @@index([course_id, section_id], map: "FK_Item_Section")
  @@index([id, section_id, course_id], map: "idx_id")
}

model ItemHistory {
  item_id    Int      @db.UnsignedSmallInt
  section_id Int      @db.UnsignedSmallInt
  course_id  Int      @db.UnsignedMediumInt
  create_at  DateTime @db.DateTime(0)
  Item       Item     @relation(fields: [item_id, section_id, course_id], references: [id, section_id, course_id], onDelete: NoAction, onUpdate: NoAction, map: "FK_ItemHistory_Item")

  @@id([item_id, section_id, course_id, create_at])
}

model ItemOrder {
  item_id       Int  @db.UnsignedSmallInt
  section_id    Int  @db.UnsignedSmallInt
  course_id     Int  @db.UnsignedMediumInt
  order_item_id Int  @db.UnsignedSmallInt
  priority      Int  @default(0) @db.UnsignedTinyInt
  Item          Item @relation(fields: [item_id, section_id, course_id], references: [id, section_id, course_id], onDelete: NoAction, onUpdate: NoAction, map: "FK_ItemOrder_Item")

  @@id([item_id, section_id, course_id])
}

model Learner {
  learner_id               Int                 @id @db.UnsignedMediumInt
  learner_default_language String              @db.VarChar(20)
  EnrollementCourse        EnrollementCourse[]
  User                     User                @relation(fields: [learner_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_Learner_User")
  ShoppingCart             ShoppingCart?
}

model Lecture {
  id              Int               @db.UnsignedSmallInt
  section_id      Int               @db.UnsignedSmallInt
  course_id       Int               @db.UnsignedMediumInt
  resource        String            @db.VarChar(2084)
  url             String            @db.VarChar(2084)
  duration        DateTime          @db.Time(0)
  Item            Item              @relation(fields: [id, section_id, course_id], references: [id, section_id, course_id], onDelete: NoAction, onUpdate: NoAction, map: "FK_Lecture_Item")
  LectureSubtitle LectureSubtitle[]

  @@id([id, section_id, course_id])
}

model LectureSubtitle {
  lecture_id        Int     @db.UnsignedSmallInt
  section_id        Int     @db.UnsignedSmallInt
  course_id         Int     @db.UnsignedMediumInt
  subtitle_language String  @db.VarChar(27)
  subtitle          String  @db.VarChar(2084)
  Lecture           Lecture @relation(fields: [lecture_id, section_id, course_id], references: [id, section_id, course_id], onDelete: NoAction, onUpdate: NoAction, map: "FK_LectureSubtitle_Lecture")

  @@id([lecture_id, section_id, course_id, subtitle_language])
}

model MonthlyCourseIncome {
  course_id                        Int                                @db.UnsignedMediumInt
  date                             DateTime                           @db.Date
  final_amount                     Int                                @db.UnsignedInt
  Course                           Course                             @relation(fields: [course_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_MonthlyCourseIncome_Course")
  MonthlyCourseIncomeVipInstructor MonthlyCourseIncomeVipInstructor[]

  @@id([course_id, date])
}

model MonthlyCourseIncomeVipInstructor {
  course_id           Int                 @db.UnsignedMediumInt
  date                DateTime            @db.Date
  vip_instructor_id   Int                 @db.UnsignedMediumInt
  revenue             Int                 @db.UnsignedInt
  MonthlyCourseIncome MonthlyCourseIncome @relation(fields: [course_id, date], references: [course_id, date], onDelete: NoAction, onUpdate: NoAction, map: "FK_MonthlyCourseIncomeVipInstructor_Course")
  VipInstructor       VipInstructor       @relation(fields: [vip_instructor_id], references: [vip_instructor_id], onDelete: NoAction, onUpdate: NoAction, map: "FK_MonthlyCourseIncomeVipInstructor_VipInstructor")

  @@id([course_id, date, vip_instructor_id])
  @@index([vip_instructor_id], map: "FK_MonthlyCourseIncomeVipInstructor_VipInstructor")
}

model Notification {
  course_id         Int                            @db.UnsignedMediumInt
  notification_type Notification_notification_type
  content           String                         @db.VarChar(10000)
  Course            Course                         @relation(fields: [course_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_Notification_Course")

  @@id([course_id, notification_type])
}

model Payment {
  id                Int                 @id @default(autoincrement()) @db.UnsignedMediumInt
  date              DateTime            @default(now()) @db.DateTime(0)
  total_price       Int                 @db.UnsignedMediumInt
  total_course      Int                 @db.UnsignedMediumInt
  EnrollementCourse EnrollementCourse[]
}

model PromotionalProgram {
  id                        Int                               @id @default(autoincrement()) @db.UnsignedTinyInt
  name                      String                            @db.VarChar(80)
  content                   String                            @db.VarChar(10000)
  day_start                 DateTime                          @db.Date
  day_end                   DateTime                          @db.Date
  repeating_type            PromotionalProgram_repeating_type
  tier_difference           Int                               @db.UnsignedTinyInt
  PromotionalProgramHistory PromotionalProgramHistory[]
}

model PromotionalProgramHistory {
  id                 Int                @db.UnsignedTinyInt
  create_at          DateTime           @default(now()) @db.DateTime(0)
  tier_difference    Int                @db.UnsignedTinyInt
  PromotionalProgram PromotionalProgram @relation(fields: [id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_PromotionalProgramHistory_PromotionalProgram")

  @@id([id, create_at])
}

model Question {
  question_id       Int      @db.UnsignedSmallInt
  section_id        Int      @db.UnsignedSmallInt
  course_id         Int      @db.UnsignedMediumInt
  item_id           Int      @db.UnsignedSmallInt
  question_datetime DateTime @db.DateTime(0)
  question_message  String   @db.VarChar(600)
  user_id           Int      @db.UnsignedMediumInt
  Answer            Answer[]
  Item              Item     @relation(fields: [item_id, section_id, course_id], references: [id, section_id, course_id], onDelete: NoAction, onUpdate: NoAction, map: "FK_Question_Item")
  User              User     @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_Question_User")

  @@id([question_id, item_id, section_id, course_id])
  @@index([item_id, section_id, course_id], map: "FK_Question_Item")
  @@index([user_id], map: "FK_Question_User")
}

model Quiz {
  id                 Int                  @db.UnsignedSmallInt
  section_id         Int                  @db.UnsignedSmallInt
  course_id          Int                  @db.UnsignedMediumInt
  Item               Item                 @relation(fields: [id, section_id, course_id], references: [id, section_id, course_id], onDelete: NoAction, onUpdate: NoAction, map: "FK_Quiz_Item")
  QuizQA             QuizQA[]
  QuizQAAnswerDetail QuizQAAnswerDetail[]

  @@id([id, section_id, course_id])
}

model QuizQA {
  id                  Int                   @db.UnsignedTinyInt
  quiz_id             Int                   @db.UnsignedSmallInt
  section_id          Int                   @db.UnsignedSmallInt
  course_id           Int                   @db.UnsignedMediumInt
  question            String                @db.VarChar(600)
  Quiz                Quiz                  @relation(fields: [quiz_id, section_id, course_id], references: [id, section_id, course_id], onDelete: NoAction, onUpdate: NoAction, map: "FK_QuizQA_Quiz")
  QuizQAAnswerMapping QuizQAAnswerMapping[]

  @@id([id, quiz_id, section_id, course_id])
  @@index([quiz_id, section_id, course_id], map: "FK_QuizQA_Quiz")
  @@index([id, quiz_id, section_id, course_id], map: "Idx")
}

model QuizQAAnswerDetail {
  id                  Int                   @db.UnsignedTinyInt
  quiz_id             Int                   @db.UnsignedSmallInt
  section_id          Int                   @db.UnsignedSmallInt
  course_id           Int                   @db.UnsignedMediumInt
  answer              String                @db.VarChar(600)
  explanation         String                @db.VarChar(600)
  Quiz                Quiz                  @relation(fields: [quiz_id, section_id, course_id], references: [id, section_id, course_id], onDelete: NoAction, onUpdate: NoAction, map: "FK_QuizQAAnswerDetail_Quiz")
  QuizQAAnswerMapping QuizQAAnswerMapping[]

  @@id([id, quiz_id, section_id, course_id])
  @@index([quiz_id, section_id, course_id], map: "FK_QuizQAAnswerDetail_Quiz")
  @@index([id, quiz_id, section_id, course_id], map: "Idx")
}

model QuizQAAnswerMapping {
  quiz_id            Int                @db.UnsignedSmallInt
  section_id         Int                @db.UnsignedSmallInt
  course_id          Int                @db.UnsignedMediumInt
  quiz_qa_id         Int                @db.UnsignedTinyInt
  answer_detail_id   Int                @db.UnsignedTinyInt
  isCorrectAnswer    Boolean            @default(false)
  QuizQA             QuizQA             @relation(fields: [quiz_id, section_id, course_id, quiz_qa_id], references: [quiz_id, section_id, course_id, id], onDelete: NoAction, onUpdate: NoAction, map: "FK_QuizQAAnswerMapping_QuizQA")
  QuizQAAnswerDetail QuizQAAnswerDetail @relation(fields: [quiz_id, section_id, course_id, answer_detail_id], references: [quiz_id, section_id, course_id, id], onDelete: NoAction, onUpdate: NoAction, map: "FK_QuizQAAnswerMapping_QuizQAAnswerDetail")
  StudentAnswerQA    StudentAnswerQA[]

  @@id([quiz_id, section_id, course_id, quiz_qa_id, answer_detail_id])
  @@index([quiz_id, section_id, course_id, answer_detail_id], map: "FK_QuizQAAnswerMapping_QuizQAAnswerDetail")
}

model Section {
  id             Int            @db.UnsignedSmallInt
  course_id      Int            @db.UnsignedMediumInt
  title          String         @db.VarChar(80)
  number_of_item Int            @default(0) @db.UnsignedSmallInt
  duration       DateTime       @db.Time(0)
  status         Section_status @default(pending)
  Item           Item[]
  Course         Course         @relation(fields: [course_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_Section_Course")
  SectionOrder   SectionOrder?

  @@id([course_id, id])
  @@index([course_id, id], map: "idx_id")
}

model SectionOrder {
  section_id       Int     @db.UnsignedSmallInt
  course_id        Int     @db.UnsignedMediumInt
  order_section_id Int     @db.UnsignedSmallInt
  priority         Int     @default(0) @db.UnsignedTinyInt
  Section          Section @relation(fields: [course_id, section_id], references: [course_id, id], onDelete: NoAction, onUpdate: NoAction, map: "FK_SectionOrder_Section")

  @@id([course_id, section_id])
}

model ShoppingCart {
  learner_id Int     @id @db.UnsignedMediumInt
  course_id  Int     @db.UnsignedMediumInt
  Learner    Learner @relation(fields: [learner_id], references: [learner_id], onDelete: NoAction, onUpdate: NoAction, map: "FK_Learner")
  Course     Course  @relation(fields: [course_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_ShoppingCart_Course")

  @@index([course_id], map: "FK_ShoppingCart_Course")
}

model StudentAnswerQA {
  quiz_id             Int                 @db.UnsignedSmallInt
  section_id          Int                 @db.UnsignedSmallInt
  course_id           Int                 @db.UnsignedMediumInt
  learner_id          Int                 @db.UnsignedMediumInt
  quiz_qa_id          Int                 @db.UnsignedTinyInt
  answer_detail_id    Int                 @db.UnsignedTinyInt
  EnrollementCourse   EnrollementCourse   @relation(fields: [course_id, learner_id], references: [course_id, learner_id], onDelete: NoAction, onUpdate: NoAction, map: "FK_StudentAnswerQA_EnrollementCourse")
  QuizQAAnswerMapping QuizQAAnswerMapping @relation(fields: [quiz_id, section_id, course_id, quiz_qa_id, answer_detail_id], references: [quiz_id, section_id, course_id, quiz_qa_id, answer_detail_id], onDelete: NoAction, onUpdate: NoAction, map: "FK_StudentAnswerQA_QuizQAAnswerMapping")

  @@id([quiz_id, section_id, course_id, learner_id, quiz_qa_id, answer_detail_id])
  @@index([course_id, learner_id], map: "FK_StudentAnswerQA_EnrollementCourse")
  @@index([quiz_id, section_id, course_id, quiz_qa_id, answer_detail_id], map: "FK_StudentAnswerQA_QuizQAAnswerMapping")
}

model SubCategory {
  id          Int      @id @db.UnsignedTinyInt
  name        String   @db.VarChar(50)
  category_id Int      @db.UnsignedTinyInt
  Course      Course[]
  Category    Category @relation(fields: [id], references: [category_id], onDelete: NoAction, onUpdate: NoAction, map: "FK_SubCategory_Category")
}

model Tier {
  id     Int      @id @default(autoincrement()) @db.UnsignedTinyInt
  price  Int      @db.UnsignedMediumInt
  Course Course[]
}

model User {
  id         Int         @id @default(autoincrement()) @db.UnsignedMediumInt
  full_name  String      @db.VarChar(52)
  email      String      @unique(map: "email") @db.VarChar(320)
  position   String      @db.VarChar(50)
  password   String      @db.VarChar(255)
  role       User_role
  Admin      Admin?
  Answer     Answer[]
  Instructor Instructor?
  Learner    Learner?
  Question   Question[]
}

model VipInstructor {
  vip_instructor_id                Int                                @id @db.UnsignedMediumInt
  tin_number                       String                             @db.Char(9)
  country                          String                             @db.VarChar(20)
  tax_filling_date                 DateTime                           @db.Date
  zip_code                         String                             @db.VarChar(6)
  image                            String                             @db.VarChar(2084)
  MonthlyCourseIncomeVipInstructor MonthlyCourseIncomeVipInstructor[]
  Instructor                       Instructor                         @relation(fields: [vip_instructor_id], references: [instructor_id], onDelete: NoAction, onUpdate: NoAction, map: "FK_VipInstructor_Instructor")
}

enum Notification_notification_type {
  adjustment
  promotional_program
  course_highlight
  price_conversion
  start_of_course
  end_of_course
}

enum Item_item_type {
  lecture
  quiz
}

enum PromotionalProgram_repeating_type {
  weekly
  monthly
  yearly
}

enum Section_status {
  pending
  publish
  unpublish
}

enum User_role {
  admin
  learner
  instructor
}

enum Course_status {
  pending
  approved
  rejected
}

enum Instructor_instructor_type {
  instructor
  vip_instructor
}
